@model IEnumerable<SIMS.DatabaseContext.Entities.Student>

@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewData["title"] = "Record Attendance";
    ViewData["breadcrumb"] = "Faculty";

    int scheduleId = ViewBag.ScheduleId;
    int courseId = ViewBag.CourseId;
    string courseName = ViewBag.CourseName;
    string className = ViewBag.ClassName;
    DateTime date = ViewBag.Date;
    Dictionary<int, bool> attendance = ViewBag.AttendanceDict as Dictionary<int, bool> ?? new();
}

<h3 class="mb-3">
    Record Attendance for <strong>@courseName</strong>
    (<span class="text-primary">@className</span>) -
    <span class="text-muted">@date.ToString("dd/MM/yyyy")</span>
</h3>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show mt-3">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<form asp-action="RecordAttendanceSubmit" method="post">
    <input type="hidden" name="scheduleId" value="@scheduleId" />

    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th>Student ID</th>
                <th>Student Name</th>
                <th class="text-center">Attendance</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var student in Model)
            {
                bool present = attendance.ContainsKey(student.StudentId) && attendance[student.StudentId];

                <tr>
                    <td>@student.StudentId</td>
                    <td>@student.FullName</td>
                    <td class="text-center">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input"
                                   type="radio"
                                   name="attendance[@student.StudentId]"
                                   value="true"
                                   @(present ? "checked" : "") />
                            <label class="form-check-label text-success fw-bold">PRESENT</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input"
                                   type="radio"
                                   name="attendance[@student.StudentId]"
                                   value="false"
                                   @(!present ? "checked" : "") />
                            <label class="form-check-label text-danger fw-bold">ABSENT</label>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary">Save Attendance</button>
    <a asp-action="AssignedCourses" asp-controller="Faculty" class="btn btn-secondary ms-2">Back</a>
</form>
