@model SIMS.DatabaseContext.Entities.Schedule

@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewData["title"] = "Add Schedule";
    ViewData["breadcrumb"] = "Schedules";
    ViewData["breadcrumb_item"] = "Add Schedules";
}

<form asp-action="Add" method="post">
    @Html.AntiForgeryToken()

    <div asp-validation-summary="All" class="text-danger mb-3"></div>

    <!-- FACULTY -->
    <div class="mb-3">
        <label asp-for="FacultyId"></label>
        <select asp-for="FacultyId" asp-items="ViewBag.Faculties"
                id="facultySelect" class="form-select">
            <option value="">-- select faculty --</option>
        </select>
    </div>

    <!-- COURSE -->
    <div class="mb-3">
        <label asp-for="CourseId"></label>
        <select asp-for="CourseId" asp-items="ViewBag.Courses"
                id="courseSelect" class="form-select">
            <option value="">-- select course --</option>
        </select>
    </div>

    <!-- CLASS -->
    <div class="mb-3">
        <label asp-for="Class"></label>
        <select asp-for="Class" id="classSelect" class="form-select">
            <option value="">-- select class --</option>

            @if (ViewBag.Classes != null)
            {
                foreach (string cls in ViewBag.Classes)
                {
                    <option value="@cls" selected="@(cls == Model.Class)">
                        @cls
                    </option>
                }
            }
        </select>
    </div>

    <!-- DATE -->
    <div class="mb-3">
        <label asp-for="Date"></label>
        <input asp-for="Date" type="date" class="form-control" />
    </div>

    <!-- TIME -->
    <div class="mb-3">
        <label>Time</label>
        <div class="d-flex gap-2">
            <input asp-for="StartTime" type="time" class="form-control" />
            <span class="align-self-center">-</span>
            <input asp-for="EndTime" type="time" class="form-control" />
        </div>
    </div>

    <!-- ROOM -->
    <div class="mb-3">
        <label asp-for="Room"></label>
        <input asp-for="Room" class="form-control" />
    </div>

    <button class="btn btn-primary">Save</button>
    <a asp-action="Index" class="btn btn-secondary">Cancel</a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        const facultySelect = document.getElementById('facultySelect');
        const courseSelect = document.getElementById('courseSelect');
        const classSelect = document.getElementById('classSelect');

        facultySelect.addEventListener('change', async () => {
            courseSelect.innerHTML = '<option value="">-- select course --</option>';
            classSelect.innerHTML = '<option value="">-- select class --</option>';

            if (!facultySelect.value) return;

            const res = await fetch(`/Schedules/GetCoursesByFaculty?facultyId=${facultySelect.value}`);
            const data = await res.json();

            data.forEach(c => {
                courseSelect.add(new Option(c.courseName, c.courseId));
            });
        });

        courseSelect.addEventListener('change', async () => {
            classSelect.innerHTML = '<option value="">-- select class --</option>';

            if (!courseSelect.value) return;

            const res = await fetch(`/Schedules/GetClassesByCourse?courseId=${courseSelect.value}`);
            const data = await res.json();

            data.forEach(cls => {
                classSelect.add(new Option(cls, cls));
            });
        });
    </script>
}
